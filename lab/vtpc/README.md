# Базовый трек. Лабораторная работа 2

## Задание

Для оптимизации работы с блочными устройствами в ОС существует кэш страниц с данными, которыми мы производим операции чтения и записи на диск. Такой кэш позволяет избежать высоких задержек при повторном доступе к данным, так как операция будет выполнена с данными в RAM, а не на диске (вспомним пирамиду памяти).

В данной лабораторной работе необходимо реализовать блочный кэш в пространстве пользователя в виде динамической библиотеки. Политику вытеснения страниц и другие элементы задания необходимо получить у преподавателя.

При выполнении работы необходимо реализовать простой API для работы с файлами, предоставляющий пользователю следующие возможности:

1. Открытие файла по заданному пути файла, доступного для чтения. Процедура
    возвращает некоторый хэндл на файл. Пример: `int lab2_open(const char *path)`.

2. Закрытие файла по хэндлу. Пример: `int lab2_close(int fd)`.

3. Чтение данных из файла.
    Пример: `ssize_t lab2_read(int fd, void buf[.count], size_t count)`.

4. Запись данных в файл.
    Пример: `ssize_t lab2_write(int fd, const void buf[.count], size_t count)`.

5. Перестановка позиции указателя на данные файла. Достаточно поддержать только
    абсолютные координаты.
    Пример: `​​​​​​​off_t lab2_lseek(int fd, off_t offset, int whence)`.

6. Синхронизация данных из кэша с диском. Пример: `int lab2_fsync(int fd)`.

Операции с диском разработанного блочного кеша должны производиться в обход page
cache ОС.

В рамках проверки работоспособности разработанного блочного кэша необходимо
адаптировать указанную преподавателем программу-загрузчик из ЛР 1, добавив
использование кэша. Запустите программу и убедитесь, что она корректно работает.
Сравните производительность до и после.

## Ограничения

1. Программа (комплекс программ) должна быть реализован на языке C.

2. Если по выданному варианту задана политика вытеснения Optimal, то необходимо
    предоставить пользователю возможность подсказать page cache, когда будет
    совершен следующий доступ к данным. Это можно сделать либо добавив параметр в
    процедуры `read` и `write` (например, 
    `ssize_t lab2_read(int fd, void buf[.count], size_t count, access_hint_t hint)`), 
    либо добавив еще одну функцию в API (например, `int lab2_advice(int fd, off_t offset, access_hint_t hint)`).
    `access_hint_t` в данном случае – это абсолютное время или временной интервал,
    по которому разработанное API будет определять время последующего доступа к
    данным.

3. Запрещено использовать высокоуровневые абстракции над системными вызовами.

## Требования к отчету и защите

Отчет должен содержать:

1. титульный лист с указанием номера и названия ЛР, вашего ФИО, ФИО
    преподавателя практики, номера вашей группы, варианта ЛР;

2. текст задания в соответствии с вариантом;

3. краткий обзор кода;

4. данные о работе программы-нагрузчика до и после внедрения своего page cache;

5. заключение с анализом результатов и выводом.
